{"version":3,"file":"rollup-plugin-commonjs.cjs.js","sources":["../src/helpers.js","../src/is-cjs.js","../src/resolve-id.js","../src/ast-utils.js","../src/utils.js","../src/transform.js","../src/index.js"],"sourcesContent":["export const PROXY_SUFFIX = '?commonjs-proxy';\nexport const getProxyId = id => `\\0${id}${PROXY_SUFFIX}`;\nexport const getIdFromProxyId = proxyId => proxyId.slice(1, -PROXY_SUFFIX.length);\n\nexport const EXTERNAL_SUFFIX = '?commonjs-external';\nexport const getExternalProxyId = id => `\\0${id}${EXTERNAL_SUFFIX}`;\nexport const getIdFromExternalProxyId = proxyId => proxyId.slice(1, -EXTERNAL_SUFFIX.length);\n\nexport const HELPERS_ID = '\\0commonjsHelpers.js';\n\n// `x['default']` is used instead of `x.default` for backward compatibility with ES3 browsers.\n// Minifiers like uglify will usually transpile it back if compatibility with ES3 is not enabled.\nexport const HELPERS = `\nexport var commonjsGlobal = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};\n\nexport function commonjsRequire () {\n\tthrow new Error('Dynamic requires are not currently supported by rollup-plugin-commonjs');\n}\n\nexport function unwrapExports (x) {\n\treturn x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;\n}\n\nexport function createCommonjsModule(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\nexport function getCjsExportFromNamespace (n) {\n\treturn n && n['default'] || n;\n}`;\n","const isCjsPromises = new Map();\n\nexport function getIsCjsPromise(id) {\n\tlet isCjsPromise = isCjsPromises.get(id);\n\tif (isCjsPromise) return isCjsPromise.promise;\n\n\tconst promise = new Promise(resolve => {\n\t\tisCjsPromise = {\n\t\t\tresolve,\n\t\t\tpromise: undefined\n\t\t};\n\t\tisCjsPromises.set(id, isCjsPromise);\n\t});\n\tisCjsPromise.promise = promise;\n\n\treturn promise;\n}\n\nexport function setIsCjsPromise(id, resolution) {\n\tconst isCjsPromise = isCjsPromises.get(id);\n\tif (isCjsPromise) {\n\t\tif (isCjsPromise.resolve) {\n\t\t\tisCjsPromise.resolve(resolution);\n\t\t\tisCjsPromise.resolve = undefined;\n\t\t}\n\t} else {\n\t\tisCjsPromises.set(id, { promise: Promise.resolve(resolution), resolve: undefined });\n\t}\n}\n","import { statSync } from 'fs';\nimport { dirname, resolve, sep } from 'path';\nimport { getExternalProxyId, getIdFromProxyId, getProxyId, HELPERS_ID, PROXY_SUFFIX } from './helpers';\n\nfunction getCandidatesForExtension(resolved, extension) {\n\treturn [resolved + extension, resolved + `${sep}index${extension}`];\n}\n\nfunction getCandidates(resolved, extensions) {\n\treturn extensions.reduce(\n\t\t(paths, extension) => paths.concat(getCandidatesForExtension(resolved, extension)),\n\t\t[resolved]\n\t);\n}\n\nexport function getResolveId(extensions) {\n\tfunction resolveExtensions(importee, importer) {\n\t\tif (importee[0] !== '.' || !importer) return; // not our problem\n\n\t\tconst resolved = resolve(dirname(importer), importee);\n\t\tconst candidates = getCandidates(resolved, extensions);\n\n\t\tfor (let i = 0; i < candidates.length; i += 1) {\n\t\t\ttry {\n\t\t\t\tconst stats = statSync(candidates[i]);\n\t\t\t\tif (stats.isFile()) return { id: candidates[i] };\n\t\t\t} catch (err) {\n\t\t\t\t/* noop */\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction resolveId(importee, importer) {\n\t\tconst isProxyModule = importee.endsWith(PROXY_SUFFIX);\n\t\tif (isProxyModule) {\n\t\t\timportee = getIdFromProxyId(importee);\n\t\t} else if (importee.startsWith('\\0')) {\n\t\t\tif (importee === HELPERS_ID) {\n\t\t\t\treturn importee;\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\tif (importer && importer.endsWith(PROXY_SUFFIX)) {\n\t\t\timporter = getIdFromProxyId(importer);\n\t\t}\n\n\t\treturn this.resolve(importee, importer, { skipSelf: true }).then(resolved => {\n\t\t\tif (!resolved) {\n\t\t\t\tresolved = resolveExtensions(importee, importer);\n\t\t\t}\n\t\t\tif (isProxyModule) {\n\t\t\t\tif (!resolved) {\n\t\t\t\t\treturn { id: getExternalProxyId(importee), external: false };\n\t\t\t\t}\n\t\t\t\tresolved.id = (resolved.external ? getExternalProxyId : getProxyId)(resolved.id);\n\t\t\t\tresolved.external = false;\n\t\t\t\treturn resolved;\n\t\t\t}\n\t\t\treturn resolved;\n\t\t});\n\t}\n\n\treturn resolveId;\n}\n","export {default as isReference} from 'is-reference';\n\nexport function flatten(node) {\n\tconst parts = [];\n\n\twhile (node.type === 'MemberExpression') {\n\t\tif (node.computed) return null;\n\n\t\tparts.unshift(node.property.name);\n\t\tnode = node.object;\n\t}\n\n\tif (node.type !== 'Identifier') return null;\n\n\tconst name = node.name;\n\tparts.unshift(name);\n\n\treturn { name, keypath: parts.join('.') };\n}\n\nexport function isTruthy(node) {\n\tif (node.type === 'Literal') return !!node.value;\n\tif (node.type === 'ParenthesizedExpression') return isTruthy(node.expression);\n\tif (node.operator in operators) return operators[node.operator](node);\n}\n\nexport function isFalsy(node) {\n\treturn not(isTruthy(node));\n}\n\nfunction not(value) {\n\treturn value === undefined ? value : !value;\n}\n\nfunction equals(a, b, strict) {\n\tif (a.type !== b.type) return undefined;\n\tif (a.type === 'Literal') return strict ? a.value === b.value : a.value == b.value;\n}\n\nconst operators = {\n\t'==': x => {\n\t\treturn equals(x.left, x.right, false);\n\t},\n\n\t'!=': x => not(operators['=='](x)),\n\n\t'===': x => {\n\t\treturn equals(x.left, x.right, true);\n\t},\n\n\t'!==': x => not(operators['==='](x)),\n\n\t'!': x => isFalsy(x.argument),\n\n\t'&&': x => isTruthy(x.left) && isTruthy(x.right),\n\n\t'||': x => isTruthy(x.left) || isTruthy(x.right)\n};\n","import { basename, dirname, extname, sep } from 'path';\nimport { makeLegalIdentifier } from 'rollup-pluginutils';\n\nexport function getName(id) {\n\tconst name = makeLegalIdentifier(basename(id, extname(id)));\n\tif (name !== 'index') {\n\t\treturn name;\n\t} else {\n\t\tconst segments = dirname(id).split(sep);\n\t\treturn makeLegalIdentifier(segments[segments.length - 1]);\n\t}\n}\n\n// Return the first non-falsy result from an array of\n// maybe-sync, maybe-promise-returning functions\nexport function first(candidates) {\n\treturn function(...args) {\n\t\treturn candidates.reduce((promise, candidate) => {\n\t\t\treturn promise.then(result =>\n\t\t\t\tresult != null ? result : Promise.resolve(candidate.call(this, ...args))\n\t\t\t);\n\t\t}, Promise.resolve());\n\t};\n}\n","import { walk } from 'estree-walker';\nimport MagicString from 'magic-string';\nimport { attachScopes, extractAssignedNames, makeLegalIdentifier } from 'rollup-pluginutils';\nimport { flatten, isFalsy, isReference, isTruthy } from './ast-utils.js';\nimport { getProxyId, HELPERS_ID } from './helpers';\nimport { getName } from './utils.js';\n\nconst reserved = 'process location abstract arguments boolean break byte case catch char class const continue debugger default delete do double else enum eval export extends false final finally float for from function goto if implements import in instanceof int interface let long native new null package private protected public return short static super switch synchronized this throw throws transient true try typeof var void volatile while with yield'.split(\n\t' '\n);\nconst blacklist = { __esModule: true };\nreserved.forEach(word => (blacklist[word] = true));\n\nconst exportsPattern = /^(?:module\\.)?exports(?:\\.([a-zA-Z_$][a-zA-Z_$0-9]*))?$/;\n\nconst firstpassGlobal = /\\b(?:require|module|exports|global)\\b/;\nconst firstpassNoGlobal = /\\b(?:require|module|exports)\\b/;\nconst importExportDeclaration = /^(?:Import|Export(?:Named|Default))Declaration/;\nconst functionType = /^(?:FunctionDeclaration|FunctionExpression|ArrowFunctionExpression)$/;\n\nfunction deconflict(scope, globals, identifier) {\n\tlet i = 1;\n\tlet deconflicted = identifier;\n\n\twhile (scope.contains(deconflicted) || globals.has(deconflicted) || deconflicted in blacklist)\n\t\tdeconflicted = `${identifier}_${i++}`;\n\tscope.declarations[deconflicted] = true;\n\n\treturn deconflicted;\n}\n\nfunction tryParse(parse, code, id) {\n\ttry {\n\t\treturn parse(code, { allowReturnOutsideFunction: true });\n\t} catch (err) {\n\t\terr.message += ` in ${id}`;\n\t\tthrow err;\n\t}\n}\n\nexport function hasCjsKeywords(code, ignoreGlobal) {\n\tconst firstpass = ignoreGlobal ? firstpassNoGlobal : firstpassGlobal;\n\treturn firstpass.test(code);\n}\n\nexport function checkEsModule(parse, code, id) {\n\tconst ast = tryParse(parse, code, id);\n\n\tlet isEsModule = false;\n\tfor (const node of ast.body) {\n\t\tif (node.type === 'ExportDefaultDeclaration')\n\t\t\treturn { isEsModule: true, hasDefaultExport: true, ast };\n\t\tif (node.type === 'ExportNamedDeclaration') {\n\t\t\tisEsModule = true;\n\t\t\tfor (const specifier of node.specifiers) {\n\t\t\t\tif (specifier.exported.name === 'default') {\n\t\t\t\t\treturn { isEsModule: true, hasDefaultExport: true, ast };\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (importExportDeclaration.test(node.type)) isEsModule = true;\n\t}\n\n\treturn { isEsModule, hasDefaultExport: false, ast };\n}\n\nexport function transformCommonjs(\n\tparse,\n\tcode,\n\tid,\n\tisEntry,\n\tignoreGlobal,\n\tignoreRequire,\n\tcustomNamedExports,\n\tsourceMap,\n\tallowDynamicRequire,\n\tastCache,\n\thasEsDefaultExport\n) {\n\tconst ast = astCache || tryParse(parse, code, id);\n\n\tconst magicString = new MagicString(code);\n\n\tconst required = {};\n\t// Because objects have no guaranteed ordering, yet we need it,\n\t// we need to keep track of the order in a array\n\tconst sources = [];\n\n\tlet uid = 0;\n\n\tlet scope = attachScopes(ast, 'scope');\n\tconst uses = { module: false, exports: false, global: false, require: false };\n\n\tlet lexicalDepth = 0;\n\tlet programDepth = 0;\n\tlet shouldSkipGlobalRenaming = false;\n\n\tconst globals = new Set();\n\n\tconst HELPERS_NAME = deconflict(scope, globals, 'commonjsHelpers'); // TODO technically wrong since globals isn't populated yet, but ¯\\_(ツ)_/¯\n\n\tconst namedExports = {};\n\n\t// TODO handle transpiled modules\n\tlet shouldWrap = /__esModule/.test(code);\n\n\tfunction isRequireStatement(node) {\n\t\tif (!node) return;\n\t\tif (node.type !== 'CallExpression') return;\n\t\tif (node.callee.name !== 'require' || scope.contains('require')) return;\n\t\tif (node.arguments.length === 0) return; // Weird case of require() without arguments\n\t\treturn true;\n\t}\n\n\tfunction hasDynamicArguments(node) {\n\t\treturn (\n\t\t\tnode.arguments.length > 1 ||\n\t\t\t(node.arguments[0].type !== 'Literal' &&\n\t\t\t\t(node.arguments[0].type !== 'TemplateLiteral' || node.arguments[0].expressions.length > 0))\n\t\t);\n\t}\n\n\tfunction isStaticRequireStatement(node) {\n\t\tif (!isRequireStatement(node)) return;\n\t\tif (hasDynamicArguments(node)) return;\n\t\tif (ignoreRequire(node.arguments[0].value)) return;\n\t\treturn true;\n\t}\n\n\tfunction getRequireStringArg(node) {\n\t\treturn node.arguments[0].type === 'Literal'\n\t\t\t? node.arguments[0].value\n\t\t\t: node.arguments[0].quasis[0].value.cooked;\n\t}\n\n\tfunction getRequired(node, name) {\n\t\tconst sourceId = getRequireStringArg(node);\n\t\tconst existing = required[sourceId];\n\t\tif (existing === undefined) {\n\t\t\tif (!name) {\n\t\t\t\tdo name = `require$$${uid++}`;\n\t\t\t\twhile (scope.contains(name));\n\t\t\t}\n\n\t\t\tsources.push(sourceId);\n\t\t\trequired[sourceId] = { source: sourceId, name, importsDefault: false };\n\t\t}\n\n\t\treturn required[sourceId];\n\t}\n\n\t// do a first pass, see which names are assigned to. This is necessary to prevent\n\t// illegally replacing `var foo = require('foo')` with `import foo from 'foo'`,\n\t// where `foo` is later reassigned. (This happens in the wild. CommonJS, sigh)\n\tconst assignedTo = new Set();\n\twalk(ast, {\n\t\tenter(node) {\n\t\t\tif (node.type !== 'AssignmentExpression') return;\n\t\t\tif (node.left.type === 'MemberExpression') return;\n\n\t\t\textractAssignedNames(node.left).forEach(name => {\n\t\t\t\tassignedTo.add(name);\n\t\t\t});\n\t\t}\n\t});\n\n\twalk(ast, {\n\t\tenter(node, parent) {\n\t\t\tif (sourceMap) {\n\t\t\t\tmagicString.addSourcemapLocation(node.start);\n\t\t\t\tmagicString.addSourcemapLocation(node.end);\n\t\t\t}\n\n\t\t\t// skip dead branches\n\t\t\tif (parent && (parent.type === 'IfStatement' || parent.type === 'ConditionalExpression')) {\n\t\t\t\tif (node === parent.consequent && isFalsy(parent.test)) return this.skip();\n\t\t\t\tif (node === parent.alternate && isTruthy(parent.test)) return this.skip();\n\t\t\t}\n\n\t\t\tif (node._skip) return this.skip();\n\n\t\t\tprogramDepth += 1;\n\n\t\t\tif (node.scope) scope = node.scope;\n\t\t\tif (functionType.test(node.type)) lexicalDepth += 1;\n\n\t\t\t// if toplevel return, we need to wrap it\n\t\t\tif (node.type === 'ReturnStatement' && lexicalDepth === 0) {\n\t\t\t\tshouldWrap = true;\n\t\t\t}\n\n\t\t\t// rewrite `this` as `commonjsHelpers.commonjsGlobal`\n\t\t\tif (node.type === 'ThisExpression' && lexicalDepth === 0) {\n\t\t\t\tuses.global = true;\n\t\t\t\tif (!ignoreGlobal)\n\t\t\t\t\tmagicString.overwrite(node.start, node.end, `${HELPERS_NAME}.commonjsGlobal`, {\n\t\t\t\t\t\tstoreName: true\n\t\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// rewrite `typeof module`, `typeof module.exports` and `typeof exports` (https://github.com/rollup/rollup-plugin-commonjs/issues/151)\n\t\t\tif (node.type === 'UnaryExpression' && node.operator === 'typeof') {\n\t\t\t\tconst flattened = flatten(node.argument);\n\t\t\t\tif (!flattened) return;\n\n\t\t\t\tif (scope.contains(flattened.name)) return;\n\n\t\t\t\tif (\n\t\t\t\t\tflattened.keypath === 'module.exports' ||\n\t\t\t\t\tflattened.keypath === 'module' ||\n\t\t\t\t\tflattened.keypath === 'exports'\n\t\t\t\t) {\n\t\t\t\t\tmagicString.overwrite(node.start, node.end, `'object'`, { storeName: false });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// rewrite `require` (if not already handled) `global` and `define`, and handle free references to\n\t\t\t// `module` and `exports` as these mean we need to wrap the module in commonjsHelpers.createCommonjsModule\n\t\t\tif (node.type === 'Identifier') {\n\t\t\t\tif (isReference(node, parent) && !scope.contains(node.name)) {\n\t\t\t\t\tif (node.name in uses) {\n\t\t\t\t\t\tif (node.name === 'require') {\n\t\t\t\t\t\t\tif (allowDynamicRequire) return;\n\t\t\t\t\t\t\tmagicString.overwrite(node.start, node.end, `${HELPERS_NAME}.commonjsRequire`, {\n\t\t\t\t\t\t\t\tstoreName: true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tuses[node.name] = true;\n\t\t\t\t\t\tif (node.name === 'global' && !shouldSkipGlobalRenaming && !ignoreGlobal) {\n\t\t\t\t\t\t\tif (parent.type === 'ImportDefaultSpecifier') {\n\t\t\t\t\t\t\t\tshouldSkipGlobalRenaming = true\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tmagicString.overwrite(node.start, node.end, `${HELPERS_NAME}.commonjsGlobal`, {\n\t\t\t\t\t\t\t\t\tstoreName: true\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// if module or exports are used outside the context of an assignment\n\t\t\t\t\t\t// expression, we need to wrap the module\n\t\t\t\t\t\tif (node.name === 'module' || node.name === 'exports') {\n\t\t\t\t\t\t\tshouldWrap = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node.name === 'define') {\n\t\t\t\t\t\tmagicString.overwrite(node.start, node.end, 'undefined', { storeName: true });\n\t\t\t\t\t}\n\n\t\t\t\t\tglobals.add(node.name);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Is this an assignment to exports or module.exports?\n\t\t\tif (node.type === 'AssignmentExpression') {\n\t\t\t\tif (node.left.type !== 'MemberExpression') return;\n\n\t\t\t\tconst flattened = flatten(node.left);\n\t\t\t\tif (!flattened) return;\n\n\t\t\t\tif (scope.contains(flattened.name)) return;\n\n\t\t\t\tconst match = exportsPattern.exec(flattened.keypath);\n\t\t\t\tif (!match || flattened.keypath === 'exports') return;\n\n\t\t\t\tuses[flattened.name] = true;\n\n\t\t\t\t// we're dealing with `module.exports = ...` or `[module.]exports.foo = ...` –\n\t\t\t\t// if this isn't top-level, we'll need to wrap the module\n\t\t\t\tif (programDepth > 3) shouldWrap = true;\n\n\t\t\t\tnode.left._skip = true;\n\n\t\t\t\tif (flattened.keypath === 'module.exports' && node.right.type === 'ObjectExpression') {\n\t\t\t\t\treturn node.right.properties.forEach(prop => {\n\t\t\t\t\t\tif (prop.computed || prop.key.type !== 'Identifier') return;\n\t\t\t\t\t\tconst name = prop.key.name;\n\t\t\t\t\t\tif (name === makeLegalIdentifier(name)) namedExports[name] = true;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (match[1]) namedExports[match[1]] = true;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// if this is `var x = require('x')`, we can do `import x from 'x'`\n\t\t\tif (\n\t\t\t\tnode.type === 'VariableDeclarator' &&\n\t\t\t\tnode.id.type === 'Identifier' &&\n\t\t\t\tisStaticRequireStatement(node.init)\n\t\t\t) {\n\t\t\t\t// for now, only do this for top-level requires. maybe fix this in future\n\t\t\t\tif (scope.parent) return;\n\n\t\t\t\t// edge case — CJS allows you to assign to imports. ES doesn't\n\t\t\t\tif (assignedTo.has(node.id.name)) return;\n\n\t\t\t\tconst required = getRequired(node.init, node.id.name);\n\t\t\t\trequired.importsDefault = true;\n\n\t\t\t\tif (required.name === node.id.name) {\n\t\t\t\t\tnode._shouldRemove = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!isStaticRequireStatement(node)) return;\n\n\t\t\tconst required = getRequired(node);\n\n\t\t\tif (parent.type === 'ExpressionStatement') {\n\t\t\t\t// is a bare import, e.g. `require('foo');`\n\t\t\t\tmagicString.remove(parent.start, parent.end);\n\t\t\t} else {\n\t\t\t\trequired.importsDefault = true;\n\t\t\t\tmagicString.overwrite(node.start, node.end, required.name);\n\t\t\t}\n\n\t\t\tnode.callee._skip = true;\n\t\t},\n\n\t\tleave(node) {\n\t\t\tprogramDepth -= 1;\n\t\t\tif (node.scope) scope = scope.parent;\n\t\t\tif (functionType.test(node.type)) lexicalDepth -= 1;\n\n\t\t\tif (node.type === 'VariableDeclaration') {\n\t\t\t\tlet keepDeclaration = false;\n\t\t\t\tlet c = node.declarations[0].start;\n\n\t\t\t\tfor (let i = 0; i < node.declarations.length; i += 1) {\n\t\t\t\t\tconst declarator = node.declarations[i];\n\n\t\t\t\t\tif (declarator._shouldRemove) {\n\t\t\t\t\t\tmagicString.remove(c, declarator.end);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!keepDeclaration) {\n\t\t\t\t\t\t\tmagicString.remove(c, declarator.start);\n\t\t\t\t\t\t\tkeepDeclaration = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tc = declarator.end;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!keepDeclaration) {\n\t\t\t\t\tmagicString.remove(node.start, node.end);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\tif (\n\t\t!sources.length &&\n\t\t!uses.module &&\n\t\t!uses.exports &&\n\t\t!uses.require &&\n\t\t(ignoreGlobal || !uses.global)\n\t) {\n\t\tif (Object.keys(namedExports).length) {\n\t\t\tthrow new Error(\n\t\t\t\t`Custom named exports were specified for ${id} but it does not appear to be a CommonJS module`\n\t\t\t);\n\t\t}\n\t\treturn null; // not a CommonJS module\n\t}\n\n\tconst includeHelpers = shouldWrap || uses.global || uses.require;\n\tconst importBlock =\n\t\t(includeHelpers ? [`import * as ${HELPERS_NAME} from '${HELPERS_ID}';`] : [])\n\t\t\t.concat(\n\t\t\t\tsources.map(source => {\n\t\t\t\t\t// import the actual module before the proxy, so that we know\n\t\t\t\t\t// what kind of proxy to build\n\t\t\t\t\treturn `import '${source}';`;\n\t\t\t\t}),\n\t\t\t\tsources.map(source => {\n\t\t\t\t\tconst { name, importsDefault } = required[source];\n\t\t\t\t\treturn `import ${importsDefault ? `${name} from ` : ``}'${getProxyId(source)}';`;\n\t\t\t\t})\n\t\t\t)\n\t\t\t.join('\\n') + '\\n\\n';\n\n\tconst namedExportDeclarations = [];\n\tlet wrapperStart = '';\n\tlet wrapperEnd = '';\n\n\tconst moduleName = deconflict(scope, globals, getName(id));\n\tif (!isEntry) {\n\t\tconst exportModuleExports = {\n\t\t\tstr: `export { ${moduleName} as __moduleExports };`,\n\t\t\tname: '__moduleExports'\n\t\t};\n\n\t\tnamedExportDeclarations.push(exportModuleExports);\n\t}\n\n\tconst name = getName(id);\n\n\tfunction addExport(x) {\n\t\tconst deconflicted = deconflict(scope, globals, name);\n\n\t\tconst declaration =\n\t\t\tdeconflicted === name\n\t\t\t\t? `export var ${x} = ${moduleName}.${x};`\n\t\t\t\t: `var ${deconflicted} = ${moduleName}.${x};\\nexport { ${deconflicted} as ${x} };`;\n\n\t\tnamedExportDeclarations.push({\n\t\t\tstr: declaration,\n\t\t\tname: x\n\t\t});\n\t}\n\n\tif (customNamedExports) customNamedExports.forEach(addExport);\n\n\tconst defaultExportPropertyAssignments = [];\n\tlet hasDefaultExport = false;\n\n\tif (shouldWrap) {\n\t\tconst args = `module${uses.exports ? ', exports' : ''}`;\n\n\t\twrapperStart = `var ${moduleName} = ${HELPERS_NAME}.createCommonjsModule(function (${args}) {\\n`;\n\t\twrapperEnd = `\\n});`;\n\t} else {\n\t\tconst names = [];\n\n\t\tast.body.forEach(node => {\n\t\t\tif (node.type === 'ExpressionStatement' && node.expression.type === 'AssignmentExpression') {\n\t\t\t\tconst left = node.expression.left;\n\t\t\t\tconst flattened = flatten(left);\n\n\t\t\t\tif (!flattened) return;\n\n\t\t\t\tconst match = exportsPattern.exec(flattened.keypath);\n\t\t\t\tif (!match) return;\n\n\t\t\t\tif (flattened.keypath === 'module.exports') {\n\t\t\t\t\thasDefaultExport = true;\n\t\t\t\t\tmagicString.overwrite(left.start, left.end, `var ${moduleName}`);\n\t\t\t\t} else {\n\t\t\t\t\tconst name = match[1];\n\t\t\t\t\tconst deconflicted = deconflict(scope, globals, name);\n\n\t\t\t\t\tnames.push({ name, deconflicted });\n\n\t\t\t\t\tmagicString.overwrite(node.start, left.end, `var ${deconflicted}`);\n\n\t\t\t\t\tconst declaration =\n\t\t\t\t\t\tname === deconflicted\n\t\t\t\t\t\t\t? `export { ${name} };`\n\t\t\t\t\t\t\t: `export { ${deconflicted} as ${name} };`;\n\n\t\t\t\t\tif (name !== 'default') {\n\t\t\t\t\t\tnamedExportDeclarations.push({\n\t\t\t\t\t\t\tstr: declaration,\n\t\t\t\t\t\t\tname\n\t\t\t\t\t\t});\n\t\t\t\t\t\tdelete namedExports[name];\n\t\t\t\t\t}\n\n\t\t\t\t\tdefaultExportPropertyAssignments.push(`${moduleName}.${name} = ${deconflicted};`);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (!hasDefaultExport) {\n\t\t\twrapperEnd = `\\n\\nvar ${moduleName} = {\\n${names\n\t\t\t\t.map(({ name, deconflicted }) => `\\t${name}: ${deconflicted}`)\n\t\t\t\t.join(',\\n')}\\n};`;\n\t\t}\n\t}\n\tObject.keys(namedExports)\n\t\t.filter(key => !blacklist[key])\n\t\t.forEach(addExport);\n\n\tif (hasEsDefaultExport) {\n\t\tvar defaultExport = '';\n\t} else if (/__esModule/.test(code)) {\n\t\tvar defaultExport = `export default ${HELPERS_NAME}.unwrapExports(${moduleName});`;\n\t} else {\n\t\tvar defaultExport = `export default ${moduleName};`;\n\t}\n\n\tconst named = namedExportDeclarations\n\t\t.filter(x => x.name !== 'default' || !hasDefaultExport)\n\t\t.map(x => x.str);\n\n\tconst exportBlock =\n\t\t'\\n\\n' +\n\t\t[defaultExport]\n\t\t\t.concat(named)\n\t\t\t.concat(hasDefaultExport ? defaultExportPropertyAssignments : [])\n\t\t\t.join('\\n');\n\n\tmagicString\n\t\t.trim()\n\t\t.prepend(importBlock + wrapperStart)\n\t\t.trim()\n\t\t.append(wrapperEnd + exportBlock);\n\n\tcode = magicString.toString();\n\tconst map = sourceMap ? magicString.generateMap() : null;\n\n\treturn { code, map };\n}\n","import { extname, resolve } from 'path';\nimport { sync as nodeResolveSync } from 'resolve';\nimport { createFilter } from 'rollup-pluginutils';\nimport { peerDependencies } from '../package.json';\nimport { EXTERNAL_SUFFIX, getIdFromExternalProxyId, getIdFromProxyId, HELPERS, HELPERS_ID, PROXY_SUFFIX } from './helpers';\nimport { getIsCjsPromise, setIsCjsPromise } from './is-cjs';\nimport { getResolveId } from './resolve-id';\nimport { checkEsModule, hasCjsKeywords, transformCommonjs } from './transform.js';\nimport { getName } from './utils.js';\n\nconst esModulesWithoutDefaultExport = new Set();\nconst esModulesWithDefaultExport = new Set();\n\n\nexport default function commonjs(options = {}) {\n\tconst extensions = options.extensions || ['.js'];\n\tconst filter = createFilter(options.include, options.exclude);\n\tconst ignoreGlobal = options.ignoreGlobal;\n\n\tconst customNamedExports = {};\n\tif (options.namedExports) {\n\t\tObject.keys(options.namedExports).forEach(id => {\n\t\t\tlet resolvedId;\n\n\t\t\ttry {\n\t\t\t\tresolvedId = nodeResolveSync(id, { basedir: process.cwd() });\n\t\t\t} catch (err) {\n\t\t\t\tresolvedId = resolve(id);\n\t\t\t}\n\n\t\t\tcustomNamedExports[resolvedId] = options.namedExports[id];\n\t\t});\n\t}\n\n\tconst allowDynamicRequire = !!options.ignore; // TODO maybe this should be configurable?\n\n\tconst ignoreRequire =\n\t\ttypeof options.ignore === 'function'\n\t\t\t? options.ignore\n\t\t\t: Array.isArray(options.ignore)\n\t\t\t\t? id => options.ignore.includes(id)\n\t\t\t\t: () => false;\n\n\tconst resolveId = getResolveId(extensions);\n\n\tconst sourceMap = options.sourceMap !== false;\n\n\tfunction transformAndCheckExports(code, id) {\n\t\t{\n\t\t\tconst { isEsModule, hasDefaultExport, ast } = checkEsModule(this.parse, code, id);\n\t\t\tconst _hasCjsKeywords = hasCjsKeywords(code, ignoreGlobal)\n\t\t\tif (isEsModule) {\n\t\t\t\t(hasDefaultExport ? esModulesWithDefaultExport : esModulesWithoutDefaultExport).add(id);\n\t\t\t\tif (!_hasCjsKeywords) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// it is not an ES module but it does not have CJS-specific elements.\n\t\t\tif (!_hasCjsKeywords) {\n\t\t\t\tesModulesWithoutDefaultExport.add(id);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst transformed = transformCommonjs(\n\t\t\t\tthis.parse,\n\t\t\t\tcode,\n\t\t\t\tid,\n\t\t\t\tthis.getModuleInfo(id).isEntry,\n\t\t\t\tignoreGlobal,\n\t\t\t\tignoreRequire,\n\t\t\t\tcustomNamedExports[id],\n\t\t\t\tsourceMap,\n\t\t\t\tallowDynamicRequire,\n\t\t\t\tast,\n\t\t\t\thasDefaultExport\n\t\t\t);\n\t\t\tif (!transformed) {\n\t\t\t\tesModulesWithoutDefaultExport.add(id);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn transformed;\n\t\t}\n\t}\n\n\treturn {\n\t\tname: 'commonjs',\n\n\t\tbuildStart() {\n\t\t\tconst [major, minor] = this.meta.rollupVersion.split('.').map(Number);\n\t\t\tconst minVersion = peerDependencies.rollup.slice(2);\n\t\t\tconst [minMajor, minMinor] = minVersion.split('.').map(Number);\n\t\t\tif (major < minMajor || (major === minMajor && minor < minMinor)) {\n\t\t\t\tthis.error(\n\t\t\t\t\t`Insufficient Rollup version: \"rollup-plugin-commonjs\" requires at least rollup@${minVersion} but found rollup@${\n\t\t\t\t\t\tthis.meta.rollupVersion\n\t\t\t\t\t}.`\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\n\t\tresolveId,\n\n\t\tload(id) {\n\t\t\tif (id === HELPERS_ID) return HELPERS;\n\n\t\t\t// generate proxy modules\n\t\t\tif (id.endsWith(EXTERNAL_SUFFIX)) {\n\t\t\t\tconst actualId = getIdFromExternalProxyId(id);\n\t\t\t\tconst name = getName(actualId);\n\n\t\t\t\treturn `import ${name} from ${JSON.stringify(actualId)}; export default ${name};`;\n\t\t\t}\n\n\t\t\tif (id.endsWith(PROXY_SUFFIX)) {\n\t\t\t\tconst actualId = getIdFromProxyId(id);\n\t\t\t\tconst name = getName(actualId);\n\n\t\t\t\treturn getIsCjsPromise(actualId).then(isCjs => {\n\t\t\t\t\tif (esModulesWithDefaultExport.has(actualId))\n\t\t\t\t\t\treturn `export {default} from ${JSON.stringify(actualId)};`;\n\t\t\t\t\telse if (isCjs)\n\t\t\t\t\t\treturn `import { __moduleExports } from ${JSON.stringify(\n\t\t\t\t\t\t\tactualId\n\t\t\t\t\t\t)}; export default __moduleExports;`;\n\t\t\t\t\telse if (esModulesWithoutDefaultExport.has(actualId))\n\t\t\t\t\t\treturn `import * as ${name} from ${JSON.stringify(actualId)}; export default ${name};`;\n\t\t\t\t\telse\n\t\t\t\t\t\treturn `import * as ${name} from ${JSON.stringify(\n\t\t\t\t\t\t\tactualId\n\t\t\t\t\t\t)}; import {getCjsExportFromNamespace} from \"${HELPERS_ID}\"; export default getCjsExportFromNamespace(${name})`;\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\ttransform(code, id) {\n\t\t\tconst isExcluded = options.exclude && options.exclude.includes && options.exclude.includes(id)\n\t\t\t\n\t\t\tif (!filter(id) || isExcluded || extensions.indexOf(extname(id)) === -1) {\n\t\t\t\tsetIsCjsPromise(id, null);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tlet transformed;\n\t\t\ttry {\n\t\t\t\ttransformed = transformAndCheckExports.call(this, code, id);\n\t\t\t} catch (err) {\n\t\t\t\ttransformed = null;\n\t\t\t\tthis.error(err, err.loc);\n\t\t\t}\n\n\t\t\tsetIsCjsPromise(id, Boolean(transformed));\n\t\t\treturn transformed;\n\t\t}\n\t};\n}\n"],"names":["PROXY_SUFFIX","getProxyId","id","getIdFromProxyId","proxyId","slice","length","EXTERNAL_SUFFIX","getExternalProxyId","getIdFromExternalProxyId","HELPERS_ID","HELPERS","isCjsPromises","Map","getIsCjsPromise","isCjsPromise","get","promise","Promise","resolve","undefined","set","setIsCjsPromise","resolution","getCandidatesForExtension","resolved","extension","sep","getCandidates","extensions","reduce","paths","concat","getResolveId","resolveExtensions","importee","importer","dirname","candidates","i","stats","statSync","isFile","err","resolveId","isProxyModule","endsWith","startsWith","skipSelf","then","external","flatten","node","parts","type","computed","unshift","property","name","object","keypath","join","isTruthy","value","expression","operator","operators","isFalsy","not","equals","a","b","strict","x","left","right","argument","getName","makeLegalIdentifier","basename","extname","segments","split","reserved","blacklist","__esModule","forEach","word","exportsPattern","firstpassGlobal","firstpassNoGlobal","importExportDeclaration","functionType","deconflict","scope","globals","identifier","deconflicted","contains","has","declarations","tryParse","parse","code","allowReturnOutsideFunction","message","hasCjsKeywords","ignoreGlobal","firstpass","test","checkEsModule","ast","isEsModule","body","hasDefaultExport","specifiers","specifier","exported","transformCommonjs","isEntry","ignoreRequire","customNamedExports","sourceMap","allowDynamicRequire","astCache","hasEsDefaultExport","magicString","MagicString","required","sources","uid","attachScopes","uses","module","exports","global","require","lexicalDepth","programDepth","shouldSkipGlobalRenaming","Set","HELPERS_NAME","namedExports","shouldWrap","isRequireStatement","callee","arguments","hasDynamicArguments","expressions","isStaticRequireStatement","getRequireStringArg","quasis","cooked","getRequired","sourceId","existing","push","source","importsDefault","assignedTo","walk","enter","extractAssignedNames","add","parent","addSourcemapLocation","start","end","consequent","skip","alternate","_skip","overwrite","storeName","flattened","isReference","match","exec","properties","prop","key","init","_shouldRemove","remove","leave","keepDeclaration","c","declarator","Object","keys","Error","includeHelpers","importBlock","map","namedExportDeclarations","wrapperStart","wrapperEnd","moduleName","exportModuleExports","str","addExport","declaration","defaultExportPropertyAssignments","args","names","filter","defaultExport","named","exportBlock","trim","prepend","append","toString","generateMap","esModulesWithoutDefaultExport","esModulesWithDefaultExport","commonjs","options","createFilter","include","exclude","resolvedId","nodeResolveSync","basedir","process","cwd","ignore","Array","isArray","includes","transformAndCheckExports","_hasCjsKeywords","transformed","getModuleInfo","buildStart","meta","rollupVersion","Number","major","minor","minVersion","peerDependencies","rollup","minMajor","minMinor","error","load","actualId","JSON","stringify","isCjs","transform","isExcluded","indexOf","call","loc","Boolean"],"mappings":"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"}